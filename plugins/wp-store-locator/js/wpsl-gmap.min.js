function initWpslMap(){var e;e=setInterval((function(){"object"==typeof google&&"object"==typeof google.maps&&(clearInterval(e),jQuery(".wpsl-gmap-canvas").each((function(e){var t=jQuery(this).attr("id");wpsl.gmaps.init(t,e)})))}),500)}var wpsl=wpsl||{};wpsl.gmaps={},jQuery(document).ready((function(e){function t(){var t,s,o,n={};if(se(),void 0===wpslSettings.geocodeComponents||e.isEmptyObject(wpslSettings.geocodeComponents)||(n.componentRestrictions=wpslSettings.geocodeComponents,n.componentRestrictions=_.omit(n.componentRestrictions,"postalCode")),void 0!==wpslSettings.autoCompleteOptions&&!e.isEmptyObject(wpslSettings.autoCompleteOptions))for(var i in wpslSettings.autoCompleteOptions)wpslSettings.autoCompleteOptions.hasOwnProperty(i)&&(n[i]=wpslSettings.autoCompleteOptions[i]);t=document.getElementById("wpsl-search-input"),(s=new google.maps.places.Autocomplete(t,n)).addListener("place_changed",(function(){(o=s.getPlace()).geometry&&(re=o.geometry.location)}))}function s(){void 0!==wpslSettings.markerZoomTo&&1==wpslSettings.markerZoomTo&&google.maps.event.addListener(ie,"zoom_changed",(function(){V()}))}function o(e){var t,s,o,i=["zoomLevel","mapType","mapTypeControl","mapStyle","streetView","scrollWheel","controlPosition"],l={zoomLevel:wpslSettings.zoomLevel,mapType:wpslSettings.mapType,mapTypeControl:wpslSettings.mapTypeControl,mapStyle:wpslSettings.mapStyle,streetView:wpslSettings.streetView,scrollWheel:wpslSettings.scrollWheel,controlPosition:wpslSettings.controlPosition,gestureHandling:wpslSettings.gestureHandling};if(void 0!==window["wpslMap_"+e]&&void 0!==window["wpslMap_"+e].shortCode)for(t=0,s=i.length;t<s;t++)void 0!==(o=window["wpslMap_"+e].shortCode[i[t]])&&(l[i[t]]=o);return l.startLatLng=n(e),l}function n(e){var t,s,o="";return void 0!==window["wpslMap_"+e]&&void 0!==window["wpslMap_"+e].locations&&(o=window["wpslMap_"+e].locations[0]),void 0!==o&&void 0!==o.lat&&void 0!==o.lng?t=new google.maps.LatLng(o.lat,o.lng):""!==wpslSettings.startLatlng?(s=wpslSettings.startLatlng.split(","),t=new google.maps.LatLng(s[0],s[1])):t=new google.maps.LatLng(0,0),t}function i(){var e,t,s={};return void 0!==wpslSettings.infoWindowStyle&&"infobox"==wpslSettings.infoWindowStyle?(e=wpslSettings.infoBoxClearance.split(","),t=wpslSettings.infoBoxPixelOffset.split(","),s={alignBottom:!0,boxClass:wpslSettings.infoBoxClass,closeBoxMargin:wpslSettings.infoBoxCloseMargin,closeBoxURL:wpslSettings.infoBoxCloseUrl,content:"",disableAutoPan:!!Number(wpslSettings.infoBoxDisableAutoPan),enableEventPropagation:!!Number(wpslSettings.infoBoxEnableEventPropagation),infoBoxClearance:new google.maps.Size(Number(e[0]),Number(e[1])),pixelOffset:new google.maps.Size(Number(t[0]),Number(t[1])),zIndex:Number(wpslSettings.infoBoxZindex)},ce=new InfoBox(s)):ce=new google.maps.InfoWindow,ce}function l(){var e,t=wpslSettings.markerIconProps,s={};for(var o in void 0!==t.url?s.url=t.url:void 0!==t.categoryMarkerUrl?s.categoryMarkerUrl=t.categoryMarkerUrl:void 0!==t.alternateMarkerUrl?s.alternateMarkerUrl=t.alternateMarkerUrl:s.url=wpslSettings.url+"img/markers/",t)t.hasOwnProperty(o)&&2==(e=t[o].split(",")).length&&(s[o]=e);return s}function a(e){(e=r(e))&&ie.setOptions({styles:e})}function r(e){try{var t=JSON.parse(e);if(t&&"object"==typeof t&&null!==t)return t}catch(e){}return!1}function p(e,t){Z(e,0,"",!0,t),N(e,be,Ce,t)}function c(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function d(t,s){if(navigator.geolocation){var o,n,i=!1,l=Number(wpslSettings.geoLocationTimeout);o=setInterval((function(){e(".wpsl-icon-direction").toggleClass("wpsl-active-icon")}),600),n=setTimeout((function(){w(o),p(t,s)}),l),navigator.geolocation.getCurrentPosition((function(i){w(o),clearTimeout(n),H(!1),g(t,i,be,s),e(".wpsl-search").addClass("wpsl-geolocation-run")}),(function(o){if(e(".wpsl-icon-direction").hasClass("wpsl-user-activated")&&!e(".wpsl-search").hasClass("wpsl-geolocation-run")){switch(o.code){case o.PERMISSION_DENIED:alert(wpslGeolocationErrors.denied);break;case o.POSITION_UNAVAILABLE:alert(wpslGeolocationErrors.unavailable);break;case o.TIMEOUT:alert(wpslGeolocationErrors.timeout);break;default:alert(wpslGeolocationErrors.generalError);break}e(".wpsl-icon-direction").removeClass("wpsl-active-icon")}else e(".wpsl-search").hasClass("wpsl-geolocation-run")||(clearTimeout(n),p(t,s))}),{maximumAge:6e4,timeout:l,enableHighAccuracy:!0})}else alert(wpslGeolocationErrors.unavailable),p(t,s)}function w(t){clearInterval(t),e(".wpsl-icon-direction").removeClass("wpsl-active-icon")}function g(e,t,s,o){if(void 0===t)p(e,o);else{var n=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);Le={position:t,newRequest:!0},ie.setCenter(n),Z(n,0,"",!0,o),N(n,s,Ce,o)}}function u(t){e("#wpsl-search-btn").bind("click",(function(s){return console.log("Executing click binding by WPSL ..."),e("#wpsl-search-input").removeClass(),e("#wpsl-search-input").val()?(oe(),1==wpslSettings.autoComplete&&void 0!==re?k(re,t):L(t)):e("#wpsl-search-input").addClass("wpsl-error").focus(),!1}))}function m(){void 0!==wpslSettings.infoWindowStyle&&"infobox"==wpslSettings.infoWindowStyle&&void 0!==ue[0]&&ue[0].close()}function f(t,s,o){google.maps.event.addListenerOnce(s,"tilesloaded",(function(){e(".gm-style").append(wpslSettings.mapControls),e(".wpsl-icon-reset, #wpsl-reset-map").length>0&&(v(t.startLatLng,o),e(".wpsl-icon-reset").hide()),e(".wpsl-icon-direction").on("click",(function(){e(this).addClass("wpsl-user-activated"),d(t.startLatLng,o)}))}))}function v(t,s){e(".wpsl-icon-reset, #wpsl-reset-map").on("click",(function(){var o=!1,n=!0;e(this).hasClass("wpsl-in-progress")||(1==wpslSettings.autoLoad&&(Ce=1),ie.getCenter().lat()===Se.centerLatlng.lat()&&ie.getCenter().lng()===Se.centerLatlng.lng()&&ie.getZoom()===Se.zoomLevel||(H(!1),e("#wpsl-search-input").val("").removeClass(),e(".wpsl-icon-reset").addClass("wpsl-in-progress"),de&&de.clearMarkers(),h(),S(),1==wpslSettings.autoLocate?g(t,Le.position,!0,s):p(t,s)),e("#wpsl-stores").show(),e("#wpsl-direction-details").hide())}))}function h(){void 0!==we&&""!==we&&(we.setMap(null),we="")}function S(){var t,s,o,n,i,l,a,r,p=e("#wpsl-wrap").hasClass("wpsl-default-filters"),c=[wpslSettings.searchRadius+" "+wpslSettings.distanceUnit,wpslSettings.maxResults],d=["wpsl-radius","wpsl-results"];for(t=0,s=d.length;t<s;t++)e("#"+d[t]+" select").val(parseInt(c[t])),e("#"+d[t]+" li").removeClass(),"wpsl-radius"==d[t]?o=wpslSettings.searchRadius:"wpsl-results"==d[t]&&(o=wpslSettings.maxResults),e("#"+d[t]+" li").each((function(){e(this).text()===c[t]&&(e(this).addClass("wpsl-selected-dropdown"),e("#"+d[t]+" .wpsl-selected-item").html(c[t]).attr("data-value",o))}));e("#wpsl-category").length&&(e("#wpsl-category select").val(0),e("#wpsl-category li").removeClass(),e("#wpsl-category li:first-child").addClass("wpsl-selected-dropdown"),n=e("#wpsl-category li:first-child").text(),e("#wpsl-category .wpsl-selected-item").html(n).attr("data-value",0)),e(".wpsl-custom-dropdown").length>0&&e(".wpsl-custom-dropdown").each((function(t){p?e(this).find("option").removeAttr("selected"):(i=e(this).siblings("div"),l=i.find("li:first-child"),a=l.text(),r=l.attr("data-value"),i.find("li").removeClass(),i.prev().html(a).attr("data-value",r))}))}function b(t){var s,o,n,i,l;for(m(),l=t.parents("li").length>0?t.parents("li").data("store-id"):t.parents(".wpsl-info-window").data("store-id"),void 0!==we&&""!==we&&(o=we.getPosition()),he={centerLatlng:ie.getCenter(),zoomLevel:ie.getZoom()},s=0,i=me.length;s<i;s++)0!=me[s].storeId||void 0!==o&&""!==o?me[s].storeId==l&&(n=me[s].getPosition()):o=me[s].getPosition();o&&n?(e("#wpsl-direction-details ul").empty(),e(".wpsl-direction-before, .wpsl-direction-after").remove(),C(o,n)):alert(wpslLabels.generalError)}function y(e,t){var s,o,n;for(s=0,o=me.length;s<o;s++)me[s].storeId==e&&(n=me[s],"start"==t?n.setAnimation(google.maps.Animation.BOUNCE):n.setAnimation(null))}function C(t,s){var o,n,i,l,a,r,p,c,d,w,g="";c="km"==wpslSettings.distanceUnit?"METRIC":"IMPERIAL",w={origin:t,destination:s,travelMode:wpslSettings.directionsTravelMode,unitSystem:google.maps.UnitSystem[c]},ae.route(w,(function(t,s){if(s==google.maps.DirectionsStatus.OK){if(le.setMap(ie),le.setDirections(t),t.routes.length>0){for(a=t.routes[0],r=0;r<a.legs.length;r++)for(o=a.legs[r],p=0,n=o.steps.length;p<n;p++)i=o.steps[p],g=g+"<li><div class='wpsl-direction-index'>"+(l=p+1)+"</div><div class='wpsl-direction-txt'>"+i.instructions+"</div><div class='wpsl-direction-distance'>"+i.distance.text+"</div></li>";for(e("#wpsl-direction-details ul").append(g).before("<div class='wpsl-direction-before'><a class='wpsl-back' id='wpsl-direction-start' href='#'>"+wpslLabels.back+"</a><div><span class='wpsl-total-distance'>"+a.legs[0].distance.text+"</span> - <span class='wpsl-total-durations'>"+a.legs[0].duration.text+"</span></div></div>").after("<p class='wpsl-direction-after'>"+t.routes[0].copyrights+"</p>"),e("#wpsl-direction-details").show(),r=0,n=me.length;r<n;r++)me[r].setMap(null);de&&de.clearMarkers(),void 0!==we&&""!==we&&we.setMap(null),e("#wpsl-stores").hide(),1==wpslSettings.templateId&&(d=e("#wpsl-gmap").offset(),e(window).scrollTop(d.top))}}else Q(s)}))}function L(t){var s,o={};void 0===wpslSettings.geocodeComponents||e.isEmptyObject(wpslSettings.geocodeComponents)?o.address=e("#wpsl-search-input").val():(o.componentRestrictions=wpslSettings.geocodeComponents,void 0!==o.componentRestrictions.postalCode?o.componentRestrictions.postalCode=e("#wpsl-search-input").val():o.address=e("#wpsl-search-input").val()),ne.geocode(o,(function(e,o){o==google.maps.GeocoderStatus.OK?(_e.enabled&&I(e),k(s=e[0].geometry.location,t)):q(o)}))}function k(e,t){var s=!1;Z(e,0,"",!0,t),N(e,be,!1,t)}function x(t,s){var o,n=t.lat().toFixed(5),i=t.lng().toFixed(5);t.lat=function(){return parseFloat(n)},t.lng=function(){return parseFloat(i)},ne.geocode({latLng:t},(function(t,n){n==google.maps.GeocoderStatus.OK?(1==wpslSettings.autoLocate&&Le.newRequest&&(""!==(o=E(t))&&e("#wpsl-search-input").val(o),Le.newRequest=!1),wpslSettings.directionRedirect&&(ge=t[0].formatted_address),_e.enabled&&e("#wpsl-search-input").val().length>0&&e.isEmptyObject(_e.addressComponents)&&I(t),s()):q(n)}))}function I(e){var t,s,o,n,i,l={},a={};for(t="GB"==(n=M(e))?{city:"postal_town",city_locality:"locality,political",region:"administrative_area_level_2,political",country:"administrative_area_level_1,political"}:{city:"locality,political",region:"administrative_area_level_1,political",country:"country,political"},s=e[0].address_components.length,Me=0;Me<s;Me++)for(var r in o=e[0].address_components[Me].types,t)t[r]==o.join(",")&&(e[0].address_components[Me].long_name.length>0?a[r]=e[0].address_components[Me].long_name:a[r]=e[0].address_components[Me].short_name);for(var r in t)void 0===a[r]&&(l[r]=t[r]);if("GB"==n&&void 0!==l.city_locality&&void 0===l.city&&(l={}),Object.keys(l).length>0)for(i=e.length,Me=1;Me<i;Me++)for(s=e[Me].address_components.length,Ee=0;Ee<s;Ee++)for(var r in o=e[Me].address_components[Ee].types,l)t[r]==o.join(",")&&(a[r]=e[Me].address_components[Ee].long_name);void 0!==a.city_locality&&a.city_locality.length>0&&(a.city=a.city_locality,delete a.city_locality),_e.addressComponents=a}function M(t){var s,o="";return e.each(t[0].address_components,(function(e){if("country,political"==(s=t[0].address_components[e].types).join(","))return o=t[0].address_components[e].short_name,!1})),o}function E(e){var t,s,o,n,i,l={},a=e.length;for(t=0;t<a;t++){for(n=e[t].address_components.length,s=0;s<n;s++){if(o=e[t].address_components[s].types,/^postal_code$/.test(o)||/^postal_code,postal_code_prefix$/.test(o)){l.zip=e[t].address_components[s].long_name;break}/^locality,political$/.test(o)&&(l.locality=e[t].address_components[s].long_name)}if(void 0!==l.zip)break}return i=void 0===l.zip&&void 0!==l.locality?l.locality:l.zip}function N(e,t,s,o){1==wpslSettings.directionRedirect||_e.enabled?x(e,(function(){R(e,t,s,o)})):R(e,t,s,o)}function R(t,s,o,n){var i,l,a,r="",p=!1,d=e("#wpsl-listing-template").html(),w=e("#wpsl-stores ul"),g=wpslSettings.url+"img/ajax-loader.gif";a=O(t,s,o),w.empty().append("<li class='wpsl-preloader'><img src='"+g+"'/>"+wpslLabels.preloader+"</li>"),e("#wpsl-wrap").removeClass("wpsl-no-results"),e.get(wpslSettings.ajaxurl,a,(function(s){e(".wpsl-preloader").remove(),s.length>0&&void 0===s.addon?(e.each(s,(function(e){_.extend(s[e],Ne),Z(i=new google.maps.LatLng(s[e].lat,s[e].lng),s[e].id,s[e],!1,n),r+=_.template(d)(s[e])})),e("#wpsl-result-list").off("click",".wpsl-directions"),w.empty(),w.append(r),e("#wpsl-result-list").on("click",".wpsl-directions",(function(){if(1!=wpslSettings.directionRedirect)return b(e(this)),!1})),U(),e("#wpsl-result-list p:empty").remove()):(Z(t,0,"",!0,n),l=T(),e("#wpsl-wrap").addClass("wpsl-no-results"),w.html("<li class='wpsl-no-results-msg'>"+l+"</li>")),1==wpslSettings.runFitBounds?G():(ie.setZoom(Number(wpslSettings.zoomLevel)),ie.setCenter(me[0].position)),1==wpslSettings.resetMap&&(e.isEmptyObject(Se)&&google.maps.event.addListenerOnce(ie,"tilesloaded",(function(){Se={centerLatlng:ie.getCenter(),zoomLevel:ie.getZoom()},e("#wpsl-map-controls").addClass("wpsl-reset-exists"),e(".wpsl-icon-reset, #wpsl-reset-map").show()})),e(".wpsl-icon-reset").removeClass("wpsl-in-progress"))})),1!=wpslSettings.mouseFocus||c()||e("#wpsl-search-input").focus()}function O(t,s,o){var n,i,l,a,r,p="",c=e("#wpsl-wrap").hasClass("wpsl-mobile"),d=e("#wpsl-wrap").hasClass("wpsl-default-filters"),w={action:"store_search",lat:t.lat(),lng:t.lng()};return s?(w.max_results=wpslSettings.maxResults,w.search_radius=wpslSettings.searchRadius):(c||d?(n=parseInt(e("#wpsl-results .wpsl-dropdown").val()),i=parseInt(e("#wpsl-radius .wpsl-dropdown").val())):(n=parseInt(e("#wpsl-results .wpsl-selected-item").attr("data-value")),i=parseInt(e("#wpsl-radius .wpsl-selected-item").attr("data-value"))),isNaN(n)?w.max_results=wpslSettings.maxResults:w.max_results=n,isNaN(i)?w.search_radius=wpslSettings.searchRadius:w.search_radius=i,void 0!==wpslSettings.categoryIds?w.filter=wpslSettings.categoryIds:e("#wpsl-category").length>0?(p=c||d?parseInt(e("#wpsl-category .wpsl-dropdown").val()):parseInt(e("#wpsl-category .wpsl-selected-item").attr("data-value")),isNaN(p)||0===p||(w.filter=p)):e("#wpsl-checkbox-filter").length>0&&e("#wpsl-checkbox-filter input:checked").length>0&&(w.filter=z()),e(".wpsl-custom-dropdown").length>0&&e(".wpsl-custom-dropdown").each((function(t){l="",a="",c||d?(l=e(this).attr("name"),a=e(this).val()):(l=e(this).attr("name"),a=e(this).next(".wpsl-selected-item").attr("data-value")),l&&a&&(w[l]=a)})),e(".wpsl-custom-checkboxes").length>0&&e(".wpsl-custom-checkboxes").each((function(t){(r=e(this).attr("data-name"))&&(w[r]=P(r))}))),1==o&&(void 0!==Le.position?w.skip_cache=1:(w.autoload=1,void 0!==wpslSettings.categoryIds&&(w.filter=wpslSettings.categoryIds))),_e.enabled&&0==o&&(w.search=e("#wpsl-search-input").val(),w.statistics=_e.addressComponents),w}function P(t){var s=e("[data-name="+t+"]"),o=[];return e(s).find("input:checked").each((function(t){o.push(e(this).val())})),o.join()}function T(){var e;return e=void 0!==wpslSettings.noResults&&""!==wpslSettings.noResults?wpslSettings.noResults:wpslLabels.noResults}function z(){var t=e("#wpsl-checkbox-filter input:checked").map((function(){return e(this).val()}));return t=(t=t.get()).join(",")}function U(){if(1==wpslSettings.markerClusters){var e,t,s=Number(wpslSettings.clusterZoom),o=Number(wpslSettings.clusterSize);isNaN(s)&&(s=""),isNaN(o)&&(o=""),void 0!==wpslSettings.excludeStartFromCluster&&1==wpslSettings.excludeStartFromCluster&&(t=me.slice(0)).splice(0,1),de=new MarkerClusterer(ie,e=void 0===t?me:t,{gridSize:o,maxZoom:s})}}function Z(e,t,s,o,n){var i,l,a,r=!0,p;0===t?(s={store:wpslLabels.startPoint},i=ve.url+wpslSettings.startMarker):i=void 0!==s.alternateMarkerUrl&&s.alternateMarkerUrl?s.alternateMarkerUrl:void 0!==s.categoryMarkerUrl&&s.categoryMarkerUrl?s.categoryMarkerUrl:ve.url+wpslSettings.storeMarker,l={url:i,scaledSize:new google.maps.Size(Number(ve.scaledSize[0]),Number(ve.scaledSize[1])),origin:new google.maps.Point(Number(ve.origin[0]),Number(ve.origin[1])),anchor:new google.maps.Point(Number(ve.anchor[0]),Number(ve.anchor[1]))},a=new google.maps.Marker({position:e,map:ie,optimized:!1,title:B(s.store),draggable:o,storeId:t,icon:l}),me.push(a),google.maps.event.addListener(a,"click",(p=ie,function(){0!=t?void 0!==wpslSettings.markerStreetView&&1==wpslSettings.markerStreetView?D(e,(function(){$(a,F(s),n,p)})):$(a,F(s),n,p):$(a,wpslLabels.startPoint,n,p),google.maps.event.clearListeners(n,"domready"),google.maps.event.addListener(n,"domready",(function(){A(a,p),V()}))})),o&&google.maps.event.addListener(a,"dragend",(function(e){H(!0),ie.setCenter(e.latLng),x(e.latLng),N(e.latLng,be,Ce=!1,n)}))}function B(e){if(e)return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(t)}))}function $(e,t,s,o){ue.length=0,s.setContent(t),s.open(o,e),ue.push(s),void 0!==wpslSettings.infoWindowStyle&&"infobox"==wpslSettings.infoWindowStyle&&1==wpslSettings.markerClusters&&(pe=e.storeId,s.setVisible(!0))}function A(t,s){e(".wpsl-info-actions a").on("click",(function(o){var n=Number(wpslSettings.autoZoomLevel);if(o.stopImmediatePropagation(),e(this).hasClass("wpsl-directions")){if(1==wpslSettings.directionRedirect)return!0;b(e(this))}else e(this).hasClass("wpsl-streetview")?W(t,s):e(this).hasClass("wpsl-zoom-here")&&(s.setCenter(t.getPosition()),s.setZoom(n));return!1}))}function V(){var t;ie.getZoom()>=wpslSettings.autoZoomLevel?e(".wpsl-zoom-here").hide():e(".wpsl-zoom-here").show()}function W(t,s){var o=s.getStreetView();o.setPosition(t.getPosition()),o.setVisible(!0),e("#wpsl-map-controls").hide(),j(o,s)}function j(t,s){google.maps.event.addListener(t,"visible_changed",(function(){if(!t.getVisible()){var o=s.getZoom();e("#wpsl-map-controls").show(),s.setZoom(o-1),s.setZoom(o)}}))}function D(e,t){var s;(new google.maps.StreetViewService).getPanoramaByLocation(e,50,(function(e,s){ye=s==google.maps.StreetViewStatus.OK,t()}))}function F(t){var s,o;return o=e("#wpsl-base-gmap_0").length?e("#wpsl-cpt-info-window-template").html():e("#wpsl-info-window-template").html(),s=_.template(o)(t)}function G(){var e,t,s=Number(wpslSettings.autoZoomLevel),o=new google.maps.LatLngBounds;for(te(ie,s),e=0,t=me.length;e<t;e++)o.extend(me[e].position);ie.fitBounds(o)}function H(e){var t,s;if(le.setMap(null),me){for(s=0,t=me.length;s<t;s++)e?1!=me[s].draggable?me[s].setMap(null):we=me[s]:me[s].setMap(null);me.length=0}de&&de.clearMarkers()}function q(e){var t;switch(e){case"ZERO_RESULTS":t=wpslLabels.noResults;break;case"OVER_QUERY_LIMIT":t=wpslLabels.queryLimit;break;default:t=wpslLabels.generalError;break}alert(t)}function Q(e){var t;switch(e){case"NOT_FOUND":case"ZERO_RESULTS":t=wpslLabels.noDirectionsFound;break;case"OVER_QUERY_LIMIT":t=wpslLabels.queryLimit;break;default:t=wpslLabels.generalError;break}alert(t)}function K(){var t=Number(wpslSettings.maxDropdownHeight);e(".wpsl-dropdown").each((function(s){var o,n,i=e(this);i.$dropdownWrap=i.wrap("<div class='wpsl-dropdown'></div>").parent(),i.$selectedVal=i.val(),i.$dropdownElem=e("<div><ul/></div>").appendTo(i.$dropdownWrap),i.$dropdown=i.$dropdownElem.find("ul"),i.$options=i.$dropdownWrap.find("option"),i.hide().removeClass("wpsl-dropdown"),e.each(i.$options,(function(){o=e(this).val()==i.$selectedVal?'class="wpsl-selected-dropdown"':"",i.$dropdown.append("<li data-value="+e(this).val()+" "+o+">"+e(this).text()+"</li>")})),i.$dropdownElem.before("<span data-value="+i.find(":selected").val()+" class='wpsl-selected-item'>"+i.find(":selected").text()+"</span>"),i.$dropdownItem=i.$dropdownElem.find("li"),i.$dropdownWrap.on("click",(function(s){e(this).hasClass("wpsl-active")?e(this).removeClass("wpsl-active"):(Y(),e(this).toggleClass("wpsl-active"),n=0,e(this).hasClass("wpsl-active")?(i.$dropdownItem.each((function(t){n+=e(this).outerHeight()})),i.$dropdownElem.css("height",n+2+"px")):i.$dropdownElem.css("height",0),n>t&&(e(this).addClass("wpsl-scroll-required"),i.$dropdownElem.css("height",t+"px")),s.stopPropagation())})),i.$dropdownItem.on("click",(function(t){i.$dropdownWrap.find(e(".wpsl-selected-item")).html(e(this).text()).attr("data-value",e(this).attr("data-value")),i.$dropdownItem.removeClass("wpsl-selected-dropdown"),e(this).addClass("wpsl-selected-dropdown"),Y(),t.stopPropagation()}))})),e(document).click((function(){Y()}))}function Y(){e(".wpsl-dropdown").removeClass("wpsl-active"),e(".wpsl-dropdown div").css("height",0)}function J(){e(".wpsl-search").hasClass("wpsl-widget")&&(e("#wpsl-search-btn").trigger("click"),e(".wpsl-search").removeClass("wpsl-widget"))}function X(){var t,s;if(_.isArray(wpslSettings.mapTabAnchor))for(t=0,s=fe.length;t<s;t++)ee(fe[t],wpslSettings.mapTabAnchor[t],t);else e("a[href='#"+wpslSettings.mapTabAnchor+"']").length&&ee(ie,wpslSettings.mapTabAnchor)}function ee(t,s,o){var n,i,l,a,r,p=!!Number(wpslSettings.mapTabAnchorReturn),c=e("a[href='#"+s+"']");l=void 0!==t.maxZoom?t.maxZoom:Number(wpslSettings.autoZoomLevel),void 0!==o&&0==o&&c.addClass("wpsl-fitbounds"),c.on("click",(function(){return setTimeout((function(){void 0!==t.map?(a=t.bounds,r=t.map):r=t,n=r.getZoom(),i=r.getCenter(),google.maps.event.trigger(r,"resize"),c.hasClass("wpsl-fitbounds")||(te(r,l),r.setZoom(n),r.setCenter(i),void 0!==a?r.fitBounds(a):G(),c.addClass("wpsl-fitbounds"))}),50),p}))}function te(e,t){google.maps.event.addListenerOnce(e,"bounds_changed",(function(){google.maps.event.addListenerOnce(e,"idle",(function(){this.getZoom()>t&&this.setZoom(t)}))}))}function se(){e("#wpsl-search-input").keypress((function(e){if(13==e.which)return oe(),L(ce),!1}))}function oe(){var t=!1;e("#wpsl-result-list ul").empty(),e("#wpsl-stores").show(),e(".wpsl-direction-before, .wpsl-direction-after").remove(),e("#wpsl-direction-details").hide(),be=!1,m(),H(!1),h()}var ne,ie,le,ae,re,pe,ce,de,we,ge,ue=[],me=[],fe=[],ve={},he={},Se={},be=!1,ye=!1,Ce="undefined"!=typeof wpslSettings?wpslSettings.autoLoad:"",Le={},_e={enabled:void 0!==wpslSettings.collectStatistics,addressComponents:""},ke,xe,Ie,Me,Ee;(_.templateSettings={evaluate:/\<\%(.+?)\%\>/g,interpolate:/\<\%=(.+?)\%\>/g,escape:/\<\%-(.+?)\%\>/g},wpsl.gmaps.init=function(n,r){var w,g,m,v,h,S,b,y,C=Number(wpslSettings.zoomLevel),L=Number(wpslSettings.autoZoomLevel);m=o(r),(y=Number(m.zoomLevel))!==C&&(L=y),v=i(),ne=new google.maps.Geocoder,le=new google.maps.DirectionsRenderer,ae=new google.maps.DirectionsService,w={zoom:y,center:m.startLatLng,mapTypeId:google.maps.MapTypeId[m.mapType.toUpperCase()],mapTypeControl:!!Number(m.mapTypeControl),streetViewControl:!!Number(m.streetView),gestureHandling:m.gestureHandling,zoomControlOptions:{position:google.maps.ControlPosition[m.controlPosition.toUpperCase()+"_TOP"]}},"cooperative"!==m.gestureHandling&&(w.scrollwheel=!!Number(m.scrollWheel)),ve=l(),ie=new google.maps.Map(document.getElementById(n),w),a(m.mapStyle),void 0!==window["wpslMap_"+r]&&void 0!==window["wpslMap_"+r].locations&&(S=new google.maps.LatLngBounds,b=window["wpslMap_"+r].locations,e.each(b,(function(e){Z(h=new google.maps.LatLng(b[e].lat,b[e].lng),b[e].id,b[e],!1,v),S.extend(h)})),b.length>1&&(te(ie,L),ie.fitBounds(S)),_.isArray(wpslSettings.mapTabAnchor)&&(g={map:ie,bounds:S,maxZoom:L},fe.push(g))),e("#wpsl-gmap").length&&(1==wpslSettings.autoComplete&&t(),!c()&&e(".wpsl-dropdown").length&&1==wpslSettings.enableStyledDropdowns?K():(e("#wpsl-search-wrap select").show(),c()?e("#wpsl-wrap").addClass("wpsl-mobile"):e("#wpsl-wrap").addClass("wpsl-default-filters")),e(".wpsl-search").hasClass("wpsl-widget")||(1==wpslSettings.autoLocate?d(m.startLatLng,v):1==wpslSettings.autoLoad&&p(m.startLatLng,v)),1!=wpslSettings.mouseFocus||c()||e("#wpsl-search-input").focus(),u(v),f(m,ie,v),J()),s()},e(".wpsl-gmap-canvas").length&&(e("<img />").attr("src",wpslSettings.url+"img/ajax-loader.gif"),e(".wpsl-gmap-canvas").each((function(t){var s=e(this).attr("id");wpsl.gmaps.init(s,t)})),X()),e("#wpsl-result-list").on("click",".wpsl-back",(function(){var t,s;for(le.setMap(null),t=0,s=me.length;t<s;t++)me[t].setMap(ie);return void 0!==we&&""!==we&&we.setMap(ie),de&&U(),ie.setCenter(he.centerLatlng),ie.setZoom(he.zoomLevel),e(".wpsl-direction-before, .wpsl-direction-after").remove(),e("#wpsl-stores").show(),e("#wpsl-direction-details").hide(),!1})),e("#wpsl-gmap").length&&("bounce"==wpslSettings.markerEffect?(e("#wpsl-stores").on("mouseenter","li",(function(){y(e(this).data("store-id"),"start")})),e("#wpsl-stores").on("mouseleave","li",(function(){y(e(this).data("store-id"),"stop")}))):"info_window"==wpslSettings.markerEffect&&e("#wpsl-stores").on("mouseenter","li",(function(){var t,s;for(t=0,s=me.length;t<s;t++)me[t].storeId==e(this).data("store-id")&&(google.maps.event.trigger(me[t],"click"),ie.setCenter(me[t].position))}))),void 0!==wpslSettings.infoWindowStyle&&"infobox"==wpslSettings.infoWindowStyle&&1==wpslSettings.markerClusters)&&google.maps.event.addListener(ie,"zoom_changed",(function(){google.maps.event.addListenerOnce(ie,"idle",(function(){if(void 0!==de&&(ke=de.clusters_).length)for(Me=0,xe=ke.length;Me<xe;Me++)for(Ee=0,Ie=ke[Me].markers_.length;Ee<Ie;Ee++)if(ke[Me].markers_[Ee].storeId==pe){ce.getVisible()&&null===ke[Me].markers_[Ee].map?ce.setVisible(!1):ce.getVisible()||null===ke[Me].markers_[Ee].map||ce.setVisible(!0);break}}))}));var Ne={formatPhoneNumber:function(e){return(1==wpslSettings.phoneUrl&&c()||1==wpslSettings.clickableDetails)&&(e="<a href='tel:"+Ne.formatClickablePhoneNumber(e)+"'>"+e+"</a>"),e},formatClickablePhoneNumber:function(e){return-1!=e.indexOf("+")&&-1!=e.indexOf("(0)")&&(e=e.replace("(0)","")),e.replace(/(-| |\(|\)|\.|)/g,"")},formatEmail:function(e){return 1==wpslSettings.clickableDetails&&(e="<a href='mailto:"+e+"'>"+e+"</a>"),e},createInfoWindowActions:function(t){var s,o="",n="";return e("#wpsl-gmap").length&&(ye&&(o="<a class='wpsl-streetview' href='#'>"+wpslLabels.streetView+"</a>"),1==wpslSettings.markerZoomTo&&(n="<a class='wpsl-zoom-here' href='#'>"+wpslLabels.zoomHere+"</a>"),s="<div class='wpsl-info-actions'>"+Ne.createDirectionUrl(t)+o+n+"</div>"),s},createDirectionUrl:function(t){var s,o,n,i={};return 1==wpslSettings.directionRedirect?(void 0===ge&&(ge=""),i.target="target='_blank'",void 0!==t?i.src=e("[data-store-id="+t+"] .wpsl-directions").attr("href"):(n=this.zip?this.zip+", ":"",o=this.address+", "+this.city+", "+n+this.country,i.src="https://www.google.com/maps/dir/?api=1&origin="+Ne.rfc3986EncodeURIComponent(ge)+"&destination="+Ne.rfc3986EncodeURIComponent(o)+"&travelmode="+wpslSettings.directionsTravelMode.toLowerCase())):i={src:"#",target:""},s="<a class='wpsl-directions' "+i.target+" href='"+i.src+"'>"+wpslLabels.directions+"</a>"},rfc3986EncodeURIComponent:function(e){return encodeURIComponent(e).replace(/[!'()*]/g,escape)}};e("#wpsl-stores").on("click",".wpsl-store-details",(function(){var t,s,o=e(this).parents("li"),n=o.data("store-id");if("info window"==wpslSettings.moreInfoLocation)for(t=0,s=me.length;t<s;t++)me[t].storeId==n&&google.maps.event.trigger(me[t],"click");else o.find(".wpsl-more-info-listings").is(":visible")?e(this).removeClass("wpsl-active-details"):e(this).addClass("wpsl-active-details"),o.siblings().find(".wpsl-store-details").removeClass("wpsl-active-details"),o.siblings().find(".wpsl-more-info-listings").hide(),o.find(".wpsl-more-info-listings").toggle();if("default"!=wpslSettings.templateId||"store listings"==wpslSettings.moreInfoLocation)return!1}))}));